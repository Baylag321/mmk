{"version":3,"file":"assets/lambda/js/chunks/form-field-Map.547aaee644e91d8e.js","mappings":"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","sources":["webpack:///node_modules/@lambda-platform/dataform/src/elements/Map.vue","webpack:///./node_modules/@lambda-platform/dataform/src/elements/Map.vue?7e24","webpack:///./node_modules/@lambda-platform/dataform/src/elements/Map.vue","webpack:///./node_modules/@lambda-platform/dataform/src/elements/Map.vue?56e0"],"sourcesContent":["<template>\n    <div class=\"lambda-map-wrapper\">\n        <FormItem :label=label :prop=rule>\n            <div class=\"lambda-lat-lng\">\n                <Input v-model=\"center.lat\" :placeholder=\"lang.latitude\" @on-blur=\"updateLat\" />\n                <Input v-model=\"center.lng\" :placeholder=\"lang.longitude\" />\n\n            </div>\n            <span>{{lang.fromCityCenter}}: {{fromCityCenter}} км</span>\n            <div class=\"lambda-map\"></div>\n        </FormItem>\n    </div>\n</template>\n\n<script>\n\nexport default {\n  props: [\"model\", \"rule\", \"label\", \"meta\"],\n  data() {\n    return {\n      map: null,\n      center: { lat: 47.9197668, lng: 106.9183483 },\n      zoom: 11,\n      marker: null, fromCityCenter:0\n    };\n  },\n\n  computed: {\n    coordinate() {\n      return this.model.form[this.model.component];\n    },\n      lang() {\n          const labels = ['fromCityCenter', 'latitude', 'longitude'\n          ];\n          return labels.reduce((obj, key, i) => {\n              obj[key] = this.$t('dataGrid.' + labels[i]);\n              return obj;\n          }, {});\n      },\n  },\n\n  watch: {\n    coordinate(value, oldValue) {\n      if ((oldValue && !value) || (value && !oldValue)) {\n        if(value){\n            let center = JSON.parse(value);\n            this.center = {\n                lat: parseFloat(center.lat),\n                lng: parseFloat(center.lng)\n            };\n            this.init();\n        }\n\n      }\n    }\n  },\n\n  mounted() {\n    this.init();\n  },\n\n  methods: {\n    init() {\n      this.map = new google.maps.Map(\n        this.$el.getElementsByClassName(\"lambda-map\")[0],\n        {\n          zoom: this.zoom,\n          center: this.center\n        }\n      );\n\n      this.marker = new google.maps.Marker({\n        map: this.map,\n        draggable: true,\n        animation: google.maps.Animation.DROP,\n        position: this.center\n      });\n\n      google.maps.event.addListener(this.map, \"click\", e => {\n        this.model.form[this.model.component] = JSON.stringify(e.latLng);\n        this.marker.setPosition(e.latLng);\n      });\n\n\n\n      this.marker.addListener(\"position_changed\", this.moveEvent.bind(this));\n    },\n      calcDistance(lat2, lon2) {\n        let lat1=47.918540;\n        let lon1=106.917658\n          let p = 0.017453292519943295;    // Math.PI / 180\n          let c = Math.cos;\n          let a = 0.5 - c((lat2 - lat1) * p)/2 +\n              c(lat1 * p) * c(lat2 * p) *\n              (1 - c((lon2 - lon1) * p))/2;\n\n          this.fromCityCenter=(12742 * Math.asin(Math.sqrt(a))).toFixed(2); // 2 * R; R = 6371 km\n      },\n\n    moveEvent() {\n      this.center = {\n        lat: this.marker\n          .getPosition()\n          .lat()\n          .toFixed(7),\n        lng: this.marker\n          .getPosition()\n          .lng()\n          .toFixed(7)\n      };\n\n      this.calcDistance(this.center.lat,this.center.lng);\n\n      let latlng = new google.maps.LatLng(this.center.lat, this.center.lng);\n      // this.map.setCenter(latlng);\n\n      this.model.form[this.model.component] = JSON.stringify(this.center);\n    },\n\n    updateLat(e) {\n      this.center.lat = parseFloat(e.target.value).toFixed(7);\n      let latlng = new google.maps.LatLng(this.center.lat, this.center.lng);\n      this.marker.setPosition(latlng);\n    },\n\n    updateLng(e) {\n      this.center.lng = parseFloat(e.target.value).toFixed(7);\n      let latlng = new google.maps.LatLng(this.center.lat, this.center.lng);\n      this.marker.setPosition(latlng);\n    }\n  }\n};\n</script>\n\n\n","import mod from \"-!../../../../vue-loader/lib/index.js??vue-loader-options!./Map.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../vue-loader/lib/index.js??vue-loader-options!./Map.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Map.vue?vue&type=template&id=60ccbfb3&\"\nimport script from \"./Map.vue?vue&type=script&lang=js&\"\nexport * from \"./Map.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"lambda-map-wrapper\"},[_c('FormItem',{attrs:{\"label\":_vm.label,\"prop\":_vm.rule}},[_c('div',{staticClass:\"lambda-lat-lng\"},[_c('Input',{attrs:{\"placeholder\":_vm.lang.latitude},on:{\"on-blur\":_vm.updateLat},model:{value:(_vm.center.lat),callback:function ($$v) {_vm.$set(_vm.center, \"lat\", $$v)},expression:\"center.lat\"}}),_vm._v(\" \"),_c('Input',{attrs:{\"placeholder\":_vm.lang.longitude},model:{value:(_vm.center.lng),callback:function ($$v) {_vm.$set(_vm.center, \"lng\", $$v)},expression:\"center.lng\"}})],1),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.lang.fromCityCenter)+\": \"+_vm._s(_vm.fromCityCenter)+\" км\")]),_vm._v(\" \"),_c('div',{staticClass:\"lambda-map\"})])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"names":["props","data","map","center","lat","lng","zoom","marker","fromCityCenter","computed","coordinate","this","model","form","component","lang","labels","reduce","obj","key","i","$t","watch","value","oldValue","JSON","parse","parseFloat","init","mounted","methods","google","maps","Map","$el","getElementsByClassName","Marker","draggable","animation","Animation","DROP","position","event","addListener","e","stringify","latLng","setPosition","moveEvent","bind","calcDistance","lat2","lon2","lat1","p","c","Math","cos","a","asin","sqrt","toFixed","getPosition","LatLng","updateLat","target","latlng","updateLng","_vm","_h","$createElement","_c","_self","staticClass","attrs","label","rule","latitude","on","callback","$$v","$set","expression","_v","longitude","_s"],"sourceRoot":""}