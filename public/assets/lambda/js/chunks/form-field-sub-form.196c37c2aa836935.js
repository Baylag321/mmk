"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[931],{65786:(t,e,o)=>{o.r(e),o.d(e,{default:()=>r});const a={props:["model","rule","label","meta"],computed:{lang:function(){var t=this,e=["notFound"];return e.reduce((function(o,a,r){return o[a]=t.$t("dataForm."+e[r]),o}),{})}},methods:{}};const r=(0,o(51900).Z)(a,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("FormItem",{attrs:{label:t.label,prop:t.rule}},[o("div",[t._v(t._s(t.lang.notFound))])])}),[],!1,null,null,null).exports},19439:(t,e,o)=>{o.r(e),o.d(e,{default:()=>l});var a=o(67130);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function n(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,a)}return o}function i(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}const s={props:["form","model","editMode","relations","formula"],components:{"grid-form":o(3758).Z,dataform:function(){return o.e(826).then(o.bind(o,26828))}},mounted:function(){this.equationRenderer(),this.form.schema.forEach((function(t){t.disabled=!0}))},computed:{lang:function(){var t=this,e=["pleaseCompleteFirstLine"];return e.reduce((function(o,a,r){return o[a]=t.$t("dataForm."+e[r]),o}),{})},subStyle:function(){return this.form.min_height?{minHeight:this.form.min_height+"px",background:"#f3f4f5"}:void 0},Lang:function(){var t=this,e=["add"];return e.reduce((function(o,a,r){return o[a]=t.$t("dataForm."+e[r]),o}),{})}},watch:{listData:{handler:function(t,e){this.hasEq&&this.equationData.map((function(e){if(e.hasEquation){e.data=-1;var o=0;switch(e.equation){case"SUM":e.data=0,t.map((function(t){e.data+=Number(isNaN(parseInt(t.model[e.model],10))?0:t.model[e.model])}));break;case"COUNT":e.data=0,t.map((function(t){e.data+=Number(1)}));break;case"MIN":t.map((function(t){-1==e.data?e.data=t.model[e.model]:e.data=Math.min(e.data,t.model[e.model])}));break;case"MAX":e.data=0,t.map((function(t){e.data=Math.max(e.data,t.model[e.model])}));break;case"AVG":e.data=0,t.map((function(t){o++,e.data+=Number(t.model[e.model])})),e.data=Number(e.data/o)}}}))},deep:!0}},data:function(){return{listData:[],equationData:[],currentSortDir:"asc",hasEq:!1,modal_show:!1,editIndex:-1}},methods:{showAddModal:function(){this.modal_show=!0,this.$modal.show("form-modal-".concat(this.form.formId))},closeModal:function(){this.modal_show=!1,this.editIndex=-1,this.$modal.hide("form-modal-".concat(this.form.formId))},formReady:function(t,e){var o=this,a=e.findIndex((function(t){return t.model==o.form.parent}));a>0&&(e[a].hidden=!0),this.editIndex>=0&&this.$refs.form.editModel(this.listData[this.editIndex].model[this.form.identity],function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach((function(e){i(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}({},this.listData[this.editIndex].model))},onError:function(){},onSuccess:function(t){var e=this;if(console.log(t),this.editIndex>=0)Object.keys(t).forEach((function(o){e.listData[e.editIndex].form.identity!=o&&"created_at"!=o&&"updated_at"!=o&&Vue.set(e.listData[e.editIndex].model,o,t[o])}));else{var o=_.cloneDeep(this.form),a={};Object.keys(t).forEach((function(e){var r=o.schema.findIndex((function(t){return"key"==t.model}));if(r>=0){if(o.identity==o.schema[r].model||null==o.schema[r].formType)return;if(o.timestamp&&("created_at"==o.schema[r].model||"updated_at"==o.schema[r].model))return}Vue.set(a,e,t[e])}));var r={form:o,model:a};null==this.model.form[this.model.component]&&(this.model.form[this.model.component]=[]),this.model.form[this.model.component].push(a),this.listData.push(r)}this.closeModal()},element:a.b,checkAddable:function(){var t=this;return new Promise((function(e,o){var a=t.listData[t.listData.length-1];if(a){var n=!1,i=a.model;for(var s in i)null!=r(i[s])&&null!=i[s]&&""!=i[s]&&0!=i[s]&&(n=!0);n?e(!0):(alert(t.lang.pleaseCompleteFirstLine),o(!1))}else e(!0)}))},addSubForm:function(){var t=_.cloneDeep(this.form),e={};t.schema.forEach((function(o){t.identity!=o.model&&null!=o.formType&&(!t.timestamp||"created_at"!=o.model&&"updated_at"!=o.model)&&Vue.set(e,o.model,o.default)}));var o={form:t,model:e};null==this.model.form[this.model.component]&&(this.model.form[this.model.component]=[]),this.model.form[this.model.component].push(e),this.listData.push(o)},add:function(){this.editIndex=-1,this.showAddModal()},fillData:function(){var t=this;this.listData=[],setTimeout((function(){t.model.form[t.model.component].forEach((function(e){var o={form:_.cloneDeep(t.form),model:e};t.listData.push(o)}))}),100)},equationRenderer:function(){var t=this;this.equationData=[],this.form.schema.map((function(e){""==e.label||e.hidden||(e.hasEquation&&(t.hasEq=!0),t.equationData.push({hasEquation:e.hasEquation,equation:e.equations,prefix:e.prefix,model:e.model,preStaticWord:e.preStaticWord,data:0}))}))},edit:function(t){this.model.form[this.form.model][t],this.editIndex=t,this.showAddModal()},remove:function(t){this.model.form[this.form.model].splice(t,1),this.listData.splice(t,1)},reset:function(){this.model.form[this.form.model]=[],this.listData=[]},sort:function(t){var e=this,o=1;this.currentSortDir="asc"===this.currentSortDir?"desc":"asc",this.currentSort="desc"===this.currentSortDir?-1:1,this.currentSort=t.model,this.listData.sort((function(t,a){return"desc"===e.currentSortDir&&(o=-1),t.model[e.currentSort]<a.model[e.currentSort]?-1*o:t.model[e.currentSort]>a.model[e.currentSort]?1*o:0}))}}};const l=(0,o(51900).Z)(s,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"subform-grid sub-modal-form",style:t.subStyle},[t.form.min_height||t.form.disableCreate?t._e():o("div",{staticClass:"subform-header"},[t._v("\n        "+t._s(t.form.name)+"\n        "),o("Button",{staticClass:"sub-form-add-btn",attrs:{shape:"circle",type:"success",size:"small",icon:"md-add"},on:{click:t.add}})],1),t._v(" "),t.form.min_height||this.listData.length>=1?o("table",{staticClass:"sub-form-grid",attrs:{border:"1"}},[o("thead",[o("tr",[t.form.showRowNumber?o("th",{staticClass:"row-number"},[t._v("ДД")]):t._e(),t._v(" "),t._l(t.form.schema,(function(e){return""==e.label||e.hidden?t._e():o("th",{key:e.index,on:{click:function(o){return t.sort(e)}}},[t._v("\n                "+t._s(e.label)+" "),o("i",{staticClass:"ti-exchange-vertical"})])})),t._v(" "),o("th",{staticClass:"action"},[t._v("...")])],2)]),t._v(" "),o("tbody",t._l(t.listData,(function(e,a){return o("grid-form",{key:a,attrs:{f:e.form,model:e.model,editMode:t.editMode,relations:t.relations,formula:t.formula}},[o("template",{slot:"action"},[o("a",{staticClass:"sub-edit",attrs:{href:"javscript:void(0)"},on:{click:function(){return t.edit(a)}}},[o("Icon",{attrs:{type:"md-create"}})],1),t._v(" "),t.form.disableDelete?t._e():o("a",{attrs:{href:"javscript:void(0)"},on:{click:function(){return t.remove(a)}}},[o("Icon",{attrs:{type:"ios-trash"}})],1)]),t._v(" "),t.form.showRowNumber?o("template",{slot:"rowNumber"},[o("span",[t._v(t._s(a+1))])]):t._e()],2)})),1),t._v(" "),t.hasEq?o("tfoot",[o("tr",[t._l(t.equationData,(function(e,a){return o("td",{key:a},[null!=e.preStaticWord&&""!=e.preStaticWord?o("span",[t._v(" "+t._s(e.preStaticWord)+" ")]):t._e(),t._v(" "),e.hasEquation?o("span",[t._v(t._s(e.data.toLocaleString()))]):t._e(),t._v(" "),null!=e.prefix&&""!=e.prefix?o("span",[t._v(" "+t._s(e.prefix))]):t._e()])})),t._v(" "),o("td")],2)]):t._e()]):t._e(),t._v(" "),t.form.min_height?o("a",{staticClass:"sub-grid-add",attrs:{href:"javascript:void(0)"},on:{click:t.add}},[o("Icon",{attrs:{type:"plus"}}),t._v("\n        "+t._s(t.lang.save)+"\n    ")],1):t._e(),t._v(" "),o("paper-modal",{staticClass:"form-modal",attrs:{name:"form-modal-"+t.form.formId,"min-width":200,"min-height":100,"pivot-y":.5,adaptive:!0,reset:!0,draggable:!0,resizable:!0,draggable:".form-tool",width:"800",height:"70%"}},[o("section",{staticClass:"form-modal"},[o("div",{staticClass:"form-tool"},[o("h4",[t._v(t._s(t.form.name))]),t._v(" "),o("div",{staticClass:"form-tool-actions"},[o("a",{attrs:{href:"javascript:void(0)"},on:{click:t.closeModal}},[o("i",{staticClass:"ti-close"})])])]),t._v(" "),o("div",{staticClass:"form-body"},[t.modal_show?o("dataform",{ref:"form",attrs:{schemaID:t.form.formId,do_render:t.modal_show,editMode:t.editIndex>=0,isSubForm:!0,onSuccess:t.onSuccess,onReady:t.formReady,onError:t.onError}}):t._e()],1)])])],1)}),[],!1,null,null,null).exports},3758:(t,e,o)=>{o.d(e,{Z:()=>i});var a=o(67130),r=(o(65821),o(10233));const n={props:["f","model","editMode","relations","formula"],created:function(){var t=this;this.f.data={},this.f.schema.forEach((function(e){t.f.identity!=e.model&&null!=e.formType&&(!t.f.timestamp||"created_at"!=e.model&&"updated_at"!=e.model)&&(t.editMode?t.setModel(e.model,t.model[e.model],e.formType):t.setModel(e.model,e.default,e.formType),t.$watch("model."+e.model,{handler:function(o,a){t.afterChange(e.model,o,a)},deep:!0}))}))},methods:{element:a.b,setModel:function(t,e,o){switch(o){case"Switch":"true"!=e&&1!=e||!0,this.model[t]=a,this.f.data[t]=a;break;case"Checkbox":var a=0;"true"!=e&&1!=e||(a=1),this.model[t]=a,this.f.data[t]=a;break;default:this.f.data[t]=e}},setMeta:function(t){return delete t.table,delete t.rules,delete t.label,delete t.span,delete t.default,t},getSchemaIndex:function(t){return this.f.schema.findIndex((function(e){return e.model==t}))},afterChange:function(t,e,o){(0,r.BS)(t,e,this.model,this.f.schema,this.$refs,this.$Notice),(0,r.x4)(this.formula,t,this.model,this.f.schema,this.f.rule,this.f.model)}}};const i=(0,o(51900).Z)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("tr",[t.f.showRowNumber?o("td",{staticClass:"row-number"},[t._t("rowNumber")],2):t._e(),t._v(" "),t._l(t.f.schema,(function(e){return void 0!==e.formType&&null!==e.formType&&e.model&&!e.hidden&&e.model!=t.f.identity&&e.model!=t.f.parent&&"updated_at"!=e.model&&"created_at"!=e.model?o("td",{key:e.index},[t.model?o(t.element(e.formType),{tag:"component",attrs:{model:{form:t.model,component:e.model},size:"small",label:e.label?e.label:"["+e.model+"]",meta:t.setMeta(e),relation_data:""==e.relation.filter||void 0===e.relation.filter?t.relations[e.relation.table]?t.relations[e.relation.table].data:[]:t.relations[e.model]?t.relations[e.model].data:[]}}):t._e()],1):t._e()})),t._v(" "),o("td",{staticClass:"action"},[t._t("action")],2)],2)}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=form-field-sub-form.196c37c2aa836935.js.map