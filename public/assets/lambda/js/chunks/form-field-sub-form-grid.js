"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2405],{9339:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var o=a(81293);const s={props:["form","model","editMode","relations","formula"],components:{"grid-form":a(50003).Z},mounted(){this.equationRenderer()},computed:{lang(){const e=["pleaseCompleteFirstLine"];return e.reduce(((t,a,o)=>(t[a]=this.$t("dataForm."+e[o]),t)),{})},subStyle(){return this.form.min_height?{minHeight:this.form.min_height+"px",background:"#f3f4f5"}:void 0},Lang(){const e=["add"];return e.reduce(((t,a,o)=>(t[a]=this.$t("dataForm."+e[o]),t)),{})}},watch:{listData:{handler:function(e,t){this.hasEq&&this.equationData.map((t=>{if(t.hasEquation){t.data=-1;let a=0;switch(t.equation){case"SUM":t.data=0,e.map((e=>{t.data+=Number(isNaN(parseInt(e.model[t.model],10))?0:e.model[t.model])}));break;case"COUNT":t.data=0,e.map((e=>{t.data+=Number(1)}));break;case"MIN":e.map((e=>{-1==t.data?t.data=e.model[t.model]:t.data=Math.min(t.data,e.model[t.model])}));break;case"MAX":t.data=0,e.map((e=>{t.data=Math.max(t.data,e.model[t.model])}));break;case"AVG":t.data=0,e.map((e=>{a++,t.data+=Number(e.model[t.model])})),t.data=Number(t.data/a)}}}))},deep:!0}},data:()=>({listData:[],equationData:[],currentSortDir:"asc",hasEq:!1,rowLength:0}),methods:{element:o.b,checkAddable(){return new Promise(((e,t)=>{let a=this.listData[this.listData.length-1];if(a){let o=!1,s=a.model;for(let e in s)null!=typeof s[e]&&null!=s[e]&&""!=s[e]&&0!=s[e]&&(o=!0);o?e(!0):(alert(this.lang.pleaseCompleteFirstLine),t(!1))}else e(!0)}))},addSubForm(){let e=_.cloneDeep(this.form),t={};e.schema.forEach((a=>{e.identity!=a.model&&null!=a.formType&&(!e.timestamp||"created_at"!=a.model&&"updated_at"!=a.model)&&Vue.set(t,a.model,a.default)}));let a={form:e,model:t};null==this.model.form[this.model.component]&&(this.model.form[this.model.component]=[]),this.model.form[this.model.component].push(t),this.listData.push(a),this.rowLength=this.model.form[this.model.component].length},add(){this.checkAddable().then((e=>{setTimeout((()=>{this.addSubForm()}),200)})).catch((e=>{console.log(e)}))},fillData(){this.listData=[],setTimeout((()=>{this.listData=[],this.model.form[this.model.component].forEach((e=>{let t={form:_.cloneDeep(this.form),model:e};this.listData.push(t)}))}),100)},equationRenderer(){this.equationData=[],this.form.schema.map((e=>{""==e.label||e.hidden||(e.hasEquation&&(this.hasEq=!0),this.equationData.push({hasEquation:e.hasEquation,equation:e.equations,prefix:e.prefix,model:e.model,preStaticWord:e.preStaticWord,data:0}))}))},remove(e){this.model.form[this.form.model].splice(e,1),this.listData.splice(e,1),this.rowLength=this.model.form[this.model.component].length},reset(){this.model.form[this.form.model]=[],this.listData=[]},sort(e){let t=1;this.currentSortDir="asc"===this.currentSortDir?"desc":"asc",this.currentSort="desc"===this.currentSortDir?-1:1,this.currentSort=e.model,this.listData.sort(((e,a)=>("desc"===this.currentSortDir&&(t=-1),e.model[this.currentSort]<a.model[this.currentSort]?-1*t:e.model[this.currentSort]>a.model[this.currentSort]?1*t:0)))}}};const l=(0,a(51900).Z)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"subform-grid",style:e.subStyle},[a("h3",{staticStyle:{display:"none"}},[e._v(e._s(e.rowLength))]),e._v(" "),e.form.min_height||e.form.disableCreate?e._e():a("div",{staticClass:"subform-header"},[e._v("\n        "+e._s(e.form.name)+"\n        "),a("Button",{staticClass:"sub-form-add-btn",attrs:{shape:"circle",type:"success",size:"small",icon:"md-add"},on:{click:e.add}})],1),e._v(" "),a("table",{attrs:{border:"1"}},[a("thead",[a("tr",[e.form.showRowNumber?a("th",{staticClass:"row-number"},[e._v("ДД")]):e._e(),e._v(" "),e._l(e.form.schema,(function(t){return""==t.label||t.hidden?e._e():a("th",{key:t.index,on:{click:function(a){return e.sort(t)}}},[e._v("\n                "+e._s(t.label)+" "),a("i",{staticClass:"ti-exchange-vertical"})])})),e._v(" "),e.form.disableDelete?e._e():a("th",{staticClass:"action"},[e._v("...")])],2)]),e._v(" "),a("tbody",e._l(e.listData,(function(t,o){return a("grid-form",{key:o,attrs:{f:t.form,model:t.model,editMode:e.editMode,relations:e.relations,formula:e.formula}},[e.form.disableDelete?e._e():a("template",{slot:"action"},[a("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.remove(o)}}},[a("Icon",{attrs:{type:"ios-trash"}})],1)]),e._v(" "),e.form.showRowNumber?a("template",{slot:"rowNumber"},[a("span",[e._v(e._s(o+1))])]):e._e()],2)})),1),e._v(" "),e.hasEq?a("tfoot",[a("tr",[e._l(e.equationData,(function(t,o){return a("td",{key:o},[null!=t.preStaticWord&&""!=t.preStaticWord?a("span",[e._v(" "+e._s(t.preStaticWord)+" ")]):e._e(),e._v(" "),t.hasEquation?a("span",[e._v(e._s(t.data.toLocaleString()))]):e._e(),e._v(" "),null!=t.prefix&&""!=t.prefix?a("span",[e._v(" "+e._s(t.prefix))]):e._e()])})),e._v(" "),a("td")],2)]):e._e()]),e._v(" "),e.form.min_height&&!e.form.disableCreate?a("a",{staticClass:"sub-grid-add",attrs:{href:"javascript:void(0)"},on:{click:e.add}},[a("Icon",{attrs:{type:"plus"}}),e._v("\n        "+e._s(e.lang.add)+"\n    ")],1):e._e()])}),[],!1,null,null,null).exports},50003:(e,t,a)=>{a.d(t,{Z:()=>r});var o=a(81293),s=(a(35341),a(54066));const l={props:["f","model","editMode","relations","formula"],created(){this.f.data={},this.f.schema.forEach((e=>{this.f.identity!=e.model&&null!=e.formType&&(!this.f.timestamp||"created_at"!=e.model&&"updated_at"!=e.model)&&(this.editMode?this.setModel(e.model,this.model[e.model],e.formType):this.setModel(e.model,e.default,e.formType),this.$watch("model."+e.model,{handler:(t,a)=>{this.afterChange(e.model,t,a)},deep:!0}))}))},methods:{element:o.b,setModel(e,t,a){switch(a){case"Switch":let a=!1;"true"!=t&&1!=t||(a=!0),this.model[e]=o,this.f.data[e]=o;break;case"Checkbox":let o=0;"true"!=t&&1!=t||(o=1),this.model[e]=o,this.f.data[e]=o;break;default:this.f.data[e]=t}},setMeta:e=>(delete e.table,delete e.rules,delete e.label,delete e.span,delete e.default,e),getSchemaIndex(e){return this.f.schema.findIndex((t=>t.model==e))},afterChange(e,t,a){(0,s.BS)(e,t,this.model,this.f.schema,this.$refs,this.$Notice),(0,s.x4)(this.formula,e,this.model,this.f.schema,this.f.rule,this.f.model)}}};const r=(0,a(51900).Z)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("tr",[e.f.showRowNumber?a("td",{staticClass:"row-number"},[e._t("rowNumber")],2):e._e(),e._v(" "),e._l(e.f.schema,(function(t){return void 0!==t.formType&&null!==t.formType&&t.model&&!t.hidden&&t.model!=e.f.identity&&t.model!=e.f.parent&&"updated_at"!=t.model&&"created_at"!=t.model?a("td",{key:t.index},[e.model?a(e.element(t.formType),{tag:"component",attrs:{model:{form:e.model,component:t.model},size:"small",label:t.label?t.label:"["+t.model+"]",meta:e.setMeta(t),relation_data:""==t.relation.filter||void 0===t.relation.filter?e.relations[t.relation.table]?e.relations[t.relation.table].data:[]:e.relations[t.model]?e.relations[t.model].data:[]}}):e._e()],1):e._e()})),e._v(" "),a("td",{staticClass:"action"},[e._t("action")],2)],2)}),[],!1,null,null,null).exports}}]);