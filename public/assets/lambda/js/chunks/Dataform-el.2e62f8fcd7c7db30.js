(self.webpackChunk=self.webpackChunk||[]).push([[826],{8883:(e,t,i)=>{var o={"./example.vue":90010};function s(e){var t=r(e);return i(t)}function r(e){if(!i.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}s.keys=function(){return Object.keys(o)},s.resolve=r,e.exports=s,s.id=8883},78518:(e,t,i)=>{"use strict";i.d(t,{Q:()=>o,b:()=>n});const o=[{element:"Text",component:()=>i.e(705).then(i.bind(i,32440))},{element:"Select",component:()=>i.e(4036).then(i.bind(i,44452))},{element:"TreeSelect",component:()=>i.e(84).then(i.bind(i,4856))},{element:"Number",component:()=>i.e(8254).then(i.bind(i,13218))},{element:"Textarea",component:()=>i.e(9343).then(i.bind(i,19435))},{element:"Date",component:()=>i.e(4218).then(i.bind(i,45746))},{element:"DateTime",component:()=>i.e(126).then(i.bind(i,66803))},{element:"Divider",component:()=>i.e(4136).then(i.bind(i,44951))},{element:"Image",component:()=>i.e(6987).then(i.bind(i,72449))},{element:"HTML",component:()=>i.e(80).then(i.bind(i,73811))},{element:"ImageSubform",component:()=>i.e(8876).then(i.bind(i,79822))},{element:"ImageDrag",component:()=>i.e(6386).then(i.bind(i,76977))},{element:"Checkbox",component:()=>i.e(1797).then(i.bind(i,76612))},{element:"CK",component:()=>i.e(6024).then(i.bind(i,16450))},{element:"ColorPicker",component:()=>i.e(6133).then(i.bind(i,21572))},{element:"Email",component:()=>i.e(2997).then(i.bind(i,10040))},{element:"File",component:()=>i.e(7997).then(i.bind(i,24338))},{element:"Download",component:()=>i.e(7455).then(i.bind(i,29306))},{element:"Geographic",component:()=>Promise.all([i.e(8204),i.e(6244)]).then(i.bind(i,91646))},{element:"Hidden",component:()=>i.e(9035).then(i.bind(i,38908))},{element:"Map",component:()=>i.e(9737).then(i.bind(i,90754))},{element:"Money",component:()=>i.e(2387).then(i.bind(i,81369))},{element:"MoneyWithoutCurrency",component:()=>i.e(2387).then(i.bind(i,34274))},{element:"NumberGenerate",component:()=>i.e(4370).then(i.bind(i,58618))},{element:"Password",component:()=>i.e(1933).then(i.bind(i,85597))},{element:"PasswordGenerate",component:()=>i.e(6566).then(i.bind(i,4445))},{element:"Radio",component:()=>i.e(7911).then(i.bind(i,48318))},{element:"FooterButton",component:()=>i.e(5075).then(i.bind(i,38087))},{element:"RadioWithTextInput",component:()=>i.e(3146).then(i.bind(i,76793))},{element:"Register",component:()=>i.e(4234).then(i.bind(i,53312))},{element:"ISelect",component:()=>Promise.all([i.e(8204),i.e(3120)]).then(i.bind(i,78381))},{element:"Search",component:()=>i.e(5182).then(i.bind(i,70037))},{element:"Switch",component:()=>i.e(3617).then(i.bind(i,49233))},{element:"Time",component:()=>i.e(973).then(i.bind(i,87236))},{element:"AdminMenu",component:()=>i.e(3666).then(i.bind(i,84260))},{element:"GridSelector",component:()=>i.e(3183).then(i.bind(i,4958))},{element:"subform/Grid",component:()=>i.e(2405).then(i.bind(i,6988))},{element:"subform/Form",component:()=>i.e(931).then(i.bind(i,41894))}],s=()=>i.e(9342).then(i.bind(i,2626)),r=()=>i.e(5955).then(i.bind(i,65150)),n=e=>{if(null!=e){const t=o.findIndex((t=>t.element==e));if(t>=0)return o[t].component}return(e=>{if(!window.init.data_form_custom_elements)return s;if(!window.init.data_form_custom_elements.find((t=>t.element==e)))return s;try{return i(8883)(`./${e}.vue`).default}catch(e){return r}})(e)}},88194:(e,t,i)=>{"use strict";i.d(t,{j1:()=>n,i:()=>a,jQ:()=>l,pg:()=>c});let o=null,s=null,r=null;const n=e=>{o=e},a=(e,t)=>{r=t,s=e},l=[{type:"required",msg:"Талбарыг бөглөнө үү!"},{type:"email",msg:"Имэйл хаягаа зөв оруулна уу!"},{type:"number",msg:"Тоон утга оруулна уу!"},{type:"mongolianMobileNumber",msg:"8 оронтой утасны дугаар оруулна уу!"},{type:"englishAlphabet",msg:"Зөвхөн латин үсэг оруулна уу!"},{type:"mongolianCyrillic",msg:"Зөвхөн кирилл үсэг оруулна уу!"},{type:"unique",msg:"Давхацсан утга оруулсан байна!"},{type:"lambda-account",msg:"Давхацсан утга оруулсан байна!"}],d=(e,t,i)=>{t.match(/^[a-zA-Z!@#\$%\^\&*\s*)\(+=._-]+$/)?i():i(new Error("Зөвхөн латин үсэг оруулна уу"))},m=(e,t,i)=>{t.match(/^[а-яөүА-ЯӨҮ0-9!@#\$%\^\&*\s*)\(+=._-]+$/)?i():i(new Error("Зөвхөн кирилл үсэг оруулна уу!"))},h=(e,t,i)=>{t.toString().match(/^[0-9]{8}$/)?i():i(new Error("8 оронтой утасны дугаар оруулна уу!"))},c=(e,t)=>{switch(t||(t=""),e.type){case"required":return{required:!0,message:e.msg};case"array":return{type:"array",required:e.required,message:e.message};case"min":return{type:"string",min:parseInt(e.val,10),message:e.msg};case"max":return{type:"string",max:parseInt(e.val,10),message:e.msg};case"email":return{type:"email",trigger:"blur",message:e.msg};case"number":return{type:"number",message:e.msg};case"mongolianMobileNumber":return{validator:h,trigger:"blur"};case"unique":return{validator:(e,i,n)=>((e,t,i,n)=>{axios.post(`${n}/lambda/krud/unique`,{table:o,identityColumn:s,identity:r,field:e.field,val:t}).then((e=>{e.data.status?i():i(new Error(e.data.msg))}))})(e,i,n,t),trigger:"blur"};case"lambda-account":return{validator:(e,i,o)=>((e,t,i,o)=>{axios.post(`${o}/lambda/check`,{value:t}).then((e=>{e.data.status?i():i(new Error(`'${t} Давхацсан утга оруулсан байна!'`))}))})(0,i,o,t),trigger:"blur"};case"englishAlphabet":return{validator:d,trigger:"blur",message:e.msg};case"mongolianCyrillic":return{validator:m,trigger:"blur"};case"check_current_password":return{validator:(e,i,o)=>((e,t,i,o)=>{axios.post(`${o}/lambda/krud/check_current_password`,{password:t}).then((e=>{e.data.status?i():i(new Error(e.data.msg))}))})(0,i,o,t),trigger:"blur"};default:return null}}},45427:(e,t,i)=>{"use strict";i.d(t,{x4:()=>r,BS:()=>a});var o=/\{ *([\w_-]+) *\}/g,s=null;function r(e,t,i,o,s,r){if(e.length>=1){let a=e.findIndex((e=>e.model==t));a<=-1?e.map((e=>{e.template.includes(t)&&n(e,t,i,o,s,r)})):n(e[a],t,i,o,s,r)}}function n(e,t,i,s,r,n){let a=!1;if(e.form?("main"==e.form||n&&e.form==n)&&(a=!0):a=!0,a){let t=(l=e.template,m=i,l.replace(o,(function(e,t){let i=m[t];return void 0===i?"":("function"==typeof i&&(i=i(m)),i)})));if(t){let o=new Function("return "+t)();e.targets.map((e=>{let t=d(s,e.field);t>=0&&("value"==e.prop?i[e.field]=o:("hidden"==e.prop&&r&&r[e.field]&&r[e.field].length>0&&r[e.field][0].hasOwnProperty("required")&&(r[e.field][0].required=!o),Vue.set(s[t],e.prop,o)))}))}}var l,m}function a(e,t,i,o,r,n,a){if(t){let t=d(o,e);t>=0&&o[t].trigger&&(s&&clearTimeout(s),s=setTimeout((()=>{!function(e,t,i,o,s,r){axios.post(e,{model:{...t},editMode:r}).then((({data:e})=>{e.schema&&e.schema.forEach((e=>{l(e,t,i,o)})),e.schema_sub&&e.schema_sub.forEach((e=>{e.schema.forEach((s=>{l(s,t,i,o,e.model)}))})),e.message&&("success"==e.message.type?s.success({duration:3,desc:e.message.message}):s.error({duration:3,desc:e.message.message})),e.info&&e.info.forEach((e=>{document.getElementById(e.target).innerHTML=e.html}))}))}(o[t].trigger,i,o,r,n,a)}),null!=o[t].triggerTimeout&&null!==o[t].triggerTimeout&&""!=o[t].triggerTimeout?o[t].triggerTimeout:0))}}function l(e,t,i,o,s){if(s){let t=d(i,s);if(t>=0){let o=d(i[t].schema,e.field);o>=0&&Object.keys(e.props).forEach((s=>{i[t].schema[o][s]=e.props[s]}))}}else{let s=d(i,e.field);if(s>=0){if("value"in e){t[e.field]=e.value,"SubForm"==i[s].formType&&o[`sf${e.field}`][0].fillData()}e.props&&Object.keys(e.props).forEach((t=>{i[s][t]=e.props[t]}))}}}function d(e,t){return e.findIndex((e=>e.model==t))}},37027:(e,t,i)=>{"use strict";i.d(t,{ZD:()=>o,Sh:()=>s,gN:()=>r});const o=(e,t)=>{const{removedIndex:i,addedIndex:o,payload:s}=t;if(null===i&&null===o)return e;const r=[...e];let n=s;return null!==i&&(n=r.splice(i,1)[0]),null!==o&&r.splice(o,0,n),r},s=e=>e&&window.init.dbSchema.tableMeta[e]?window.init.dbSchema.tableMeta[e]:[],r=(e,t)=>""==e.relation.filter||void 0===e.relation.filter?t[e.relation.table]?t[e.relation.table].data:e.relation.filterWithUser&&t[e.model]?t[e.model].data:[]:t[e.model]?t[e.model].data:[]},14006:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ul:()=>idGenerator,GY:()=>evalstr,JY:()=>isValid});const idGenerator=e=>`${e}-${Math.random().toString(36).substr(3,9)}`,evalstr=str=>void 0===str||null==str||""==str||eval(str.toString()),isValid=e=>void 0!==e&&null!=e&&""!=e},90010:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});const o={props:["model","rule","label","meta"]};const s=(0,i(51900).Z)(o,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("FormItem",{attrs:{prop:e.rule,label:e.label}},[i("Input",{attrs:{type:"text",placeholder:e.meta&&null!==e.meta.placeHolder?e.meta.placeHolder:e.label,disabled:!(!e.meta||!e.meta.disabled)&&e.meta.disabled},model:{value:e.model.form[e.model.component],callback:function(t){e.$set(e.model.form,e.model.component,t)},expression:"model.form[model.component]"}})],1)}),[],!1,null,null,null).exports},30439:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});var o=i(78518),s=i(88194),r=/\{ *([\w_-]+) *\}/g;var n=i(45427),a=i(14006),l=i(37027);const d={mixins:[{name:"dataform",props:["projectID","schemaID","editMode","onReady","onSuccess","onError","permissions","user_condition","formCustomData","do_render","isSubForm","url","page_id","public","title","close"],data:()=>({formTitle:"",loadConfig:!0,viewMode:!1,asyncMode:!1,save_btn_text:"",formValidationCustomText:"",meta:{model:"",option:{}},model:{},schema:[],ui:{},formula:[],rule:{},identity:null,dataID:null,relations:{},showInfo:!1,infoUrl:"",infoTitle:"",showID:window.init&&window.init.showID?window.init.showID:void 0,subFormValidations:[],extraButtons:[],disableReset:!1,withBackButton:!1}),computed:{baseUrl(){return this.$props.url?this.$props.url:""},submitUrl(){return this.editMode?this.page_id?`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/update/${this.dataID}?page_id=${this.page_id}`:`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/update/${this.dataID}`:this.page_id?`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/store?page_id=${this.page_id}`:`${this.baseUrl}/lambda/krud${this.optionUrl}/${this.$props.schemaID}/store`},optionUrl(){return!0===this.public?"-public":""},lang(){const e=["save","pleaseWait","fillInTheNewOne","close","pleaseEnterPasswordYouUCurrentlyUsing","pleaseReEnterYourPassword","passwordConfirmError","informationIsIncomplete","trRMandatoryFieldsFillInformationLookFormAFillRequiredFieldsWithRedBorder","successfullySaved","errorSaving"];return e.reduce(((t,i,o)=>(t[i]=this.$t("dataForm."+e[o]),t)),{})}},created(){window.showInformationModal=this.showInformationModal,this.schemaID&&this.initForm()},watch:{src(e,t){this.initForm()},editMode(e){e||this.handleReset(this.meta.model+"-"+this.schemaID)},do_render(e){e||(this.viewMode=!1,this.handleReset(this.meta.model+"-"+this.schemaID))},schemaID(e){e&&this.initForm()},ui(e){e&&this.dataID&&this.editModel(this.dataID)}},methods:{createWithTemplate(e){return t=e,i=this.model,t.replace(r,(function(e,t){let o=i[t];return void 0===o?"":("function"==typeof o&&(o=o(i)),o)}));var t,i},isVisibleSection(e){let t=this.showAbleFields(e.children);return!("section"!=e.type||!t)&&(!e.visibleUserRoles||!t||(!Array.isArray(e.visibleUserRoles)||!t||(!(e.visibleUserRoles.length>=1&&window.init.user&&t)||!!(e.visibleUserRoles.findIndex((e=>e==window.init.user.role))>=0&&t))))},showAbleFields(e){for(let t of e){if("form"==t.type||"Form"==t.type)return!!this.isShow(t.model);if("SubForm"==t.formType)return!0;if("row"==t.type){let e=!1;for(let i of t.children){this.showAbleFields(i.children)&&(e=!0)}return e}if(t.hasOwnProperty("children")){return!!this.showAbleFields(t.children)}return!!this.isShow(t.model)}},element:o.b,evalstr:a.GY,isValid:a.JY,isShow(e){let t=this.schema.findIndex((t=>t.model==e));return!(t>=0)||!this.schema[t].hidden},afterChange(e,t,i){(0,n.BS)(e,t,this.model,this.schema,this.$refs,this.$Notice,this.editMode),this.do_render&&t!=i&&(0,n.x4)(this.formula,e,this.model,this.schema,this.rule,!1)},clearConfig(){this.model={},this.schema=[],this.ui={},this.formula=[],this.rule={},this.dataID=null},async initFromServerData(e){let t=this.baseUrl+`/lambda/puzzle/schema${this.optionUrl}/form/${this.$props.schemaID}`;this.projectID&&(t=this.baseUrl+`/lambda/puzzle/project/${this.projectID}/form/${this.$props.schemaID}`),t+=0==e.length?"":`/${e}`;try{let e=await axios.get(t),i=JSON.parse(e.data.data.schema);return i.form_id=e.data.data.id,i.form_name=e.data.data.name,i}catch(e){return void console.error(e.message)}},async initForm(){let e=[];this.user_condition&&(e=JSON.stringify(this.user_condition));let t={};t=window.init&&window.init.formSchemas&&window.init.formSchemas[this.$props.schemaID]?window.init.formSchemas[this.$props.schemaID]:await this.initFromServerData(e),this.identity=t.identity,this.schema=t.schema,this.ui=t.ui,t.save_btn_text&&(this.save_btn_text=t.save_btn_text),t.formValidationCustomText&&(this.formValidationCustomText=t.formValidationCustomText),t.formula&&(this.formula=t.formula),t.extraButtons&&(this.extraButtons=t.extraButtons),t.disableReset&&(this.disableReset=t.disableReset),t.withBackButton&&(this.withBackButton=t.withBackButton),this.formTitle=t.form_name,this.meta={model:t.model,option:{labelPosition:t.labelPosition,labelWidth:t.labelWidth}},this.getOptionsData(t.schema),this.setUiSchemaFormItem(t.ui.schema),this.setHiddenItemModel(t.schema),(0,s.j1)(t.model),this.setUserConditionValues(!0),this.setCustomData(),this.loadConfig=!1,this.$props.onReady&&this.$props.onReady(t,this.schema)},setHiddenItemModel(e){e.forEach((e=>{if((e.hidden||e.disabled)&&(this.isValid(e.default)&&this.setModel(e.model,e.default,e.formType),e.hasUserId&&this.setModel(e.model,1*window.init.user.id,e.formType),null!==e.fillByUserField&&""!==e.fillByUserField&&void 0!==e.fillByUserField&&this.setModel(e.model,window.init.user[e.fillByUserField],e.formType),this.isValid(e.param)&&e.param in this.$route.params)){let t=this.$route.params[e.param];"null"!=t&&Vue.set(this.$data.model,e.model,t)}e.source_hidden=e.hidden,e.source_disabled=e.disabled}))},validatePassCheck(e,t,i,o){let s=i||"",r=this.model[e]?this.model[e]:"";""!==i||this.editMode?s!==r?o(new Error(this.lang.passwordConfirmError)):o():o(new Error(this.lang.pleaseReEnterYourPassword))},setUiSchemaFormItem(e){e.forEach((e=>{if("form"==e.type){if(this.setModel(e.model,e.default,e.formType),this.$watch("model."+e.model,{handler:(t,i)=>{this.afterChange(e.model,t,i)},deep:!0}),e.rules&&this.setRule(e.model,e.rules),"Password"==e.formType&&e.passwordOption&&(e.passwordOption.confirm&&(this.setModel("password_confirm","","password"),this.$data.rule.password_confirm=[{validator:(t,i,o)=>this.validatePassCheck(e.model,t,i,o),trigger:"blur"}]),e.passwordOption.edit_with_old_password)){this.setModel("current_password","","password");let e=[];[{type:"required",msg:this.lang.pleaseEnterPasswordYouUCurrentlyUsing},{type:"check_current_password",msg:null}].forEach((t=>{let i=(0,s.pg)(t,this.url);e.push(i)})),this.$data.rule.current_password=e}}else"SubForm"==e.formType?(this.setModel(e.model,[],"SubForm"),e.checkEmpty&&this.subFormValidations.push({model:e.model,emptyErrorMsg:e.EmptyErrorMsg?e.EmptyErrorMsg:`${e.name}-д мэдээлэл бүртгэнэ үү`})):_.isArray(e.children)&&this.setUiSchemaFormItem(e.children)}))},setModel(e,t,i){switch(i){case"Switch":let i=!1;"true"!=t&&1!=t||(i=!0),Vue.set(this.$data.model,e,i);break;case"Checkbox":let o=0;"true"!=t&&1!=t||(o=1),Vue.set(this.$data.model,e,o);break;case"CK":let s="";""!=t&&null!==t&&(s=t),Vue.set(this.$data.model,e,s);break;case"SubForm":Vue.set(this.$data.model,e,[]);break;case"Select":""==t||null===t?Vue.set(this.$data.model,e,null):isNaN(t)?Vue.set(this.$data.model,e,t):Vue.set(this.$data.model,e,1*t);break;case"Number":null!==t&&Vue.set(this.$data.model,e,1*t);break;case"ISelect":Vue.set(this.$data.model,e,t);default:Vue.set(this.$data.model,e,t)}},setRule(e,t){this.$data.rule[e]=[],t.forEach((t=>{let i=(0,s.pg)(t,this.url);this.$data.rule[e].push(i)}))},setMeta(e,t){let i=this.schema.findIndex((t=>t.model==e.model)),o=i>=0?this.schema[i]:e;return t||(delete o.table,delete o.extra,o.schemaID=this.$props.schemaID),o},getSchemaByModel(e){let t=this.schema.findIndex((t=>t.model==e));return t>=0?this.schema[t]:null},getSchemaRelationByModel(e){let t=this.schema.findIndex((t=>t.model==e));return t>=0?(0,l.gN)(this.schema[t],this.relations):null},setSchemaByModel(e,t,i,o){if("value"==t)Vue.set(this.$data.model,e,i);else if("sub-value"==t)Vue.set(this.$data.model,e,i),this.subFormFillData(e);else{let s=this.schema.findIndex((t=>t.model==e));if(s>=0)if(void 0!==o){if("SubForm"==this.schema[s].formType){let e=this.schema[s].schema.findIndex((e=>e.model==o));e>=0&&Vue.set(this.schema[s].schema[e],t,i)}}else Vue.set(this.schema[s],t,i)}},getSubFormData(e){let t=[];this.model[e].forEach((e=>{t.push(e.data)}))},handleSubmit(e){this.setIdentityManual(),_.isEmpty(this.$data.rule)?this.subFormValidations.length>=1?this.validateWithSubForm():this.postData():this.$refs[e].validate((e=>{e?this.subFormValidations.length>=1?this.validateWithSubForm():this.postData():this.$Notice.error({title:this.lang.informationIsIncomplete,desc:""!=this.formValidationCustomText?this.formValidationCustomText:this.lang.trRMandatoryFieldsFillInformationLookFormAFillRequiredFieldsWithRedBorder,duration:0})}))},validateWithSubForm(){let e=!0;this.subFormValidations.forEach((t=>{let i=_.isArray(this.model[t.model]);(void 0===this.model[t.model]||null===this.model[t.model]||i)&&(i?0==this.model[t.model].length&&(this.$Notice.error({title:this.lang.informationIsIncomplete,desc:t.emptyErrorMsg,duration:0}),e=!1):(this.$Notice.error({title:this.lang.informationIsIncomplete,desc:t.emptyErrorMsg,duration:0}),e=!1))})),e&&this.postData()},postData(){this.isSubForm?this.$props.onSuccess(this.$data.model):(this.asyncMode=!0,axios.post(this.submitUrl,this.$data.model).then((({data:e})=>{e.status?(this.$Notice.success({title:this.lang.successfullySaved}),this.editMode?this.$props.onSuccess&&this.$props.onSuccess(e.data):(this.$data.model[this.identity]=e[this.identity],this.$props.onSuccess&&this.$props.onSuccess(e.data),this.handleReset(this.meta.model+"-"+this.schemaID))):(this.$Notice.error({title:this.lang.errorSaving}),this.$props.onError&&this.$props.onError()),this.asyncMode=!1})).catch((e=>{let t="";e.response?(e.response.data.hasOwnProperty("error")&&("string"==typeof e.response.data.error||e.response.data.error instanceof String?t=e.response.data.error:e.response.data.error instanceof Object&&Object.keys(e.response.data.error).forEach((i=>{let o=i+": "+e.response.data.error[i].map((e=>e+" "));t=""!=t?t+"<br/>"+o:o}))),this.$Notice.error({title:this.lang.errorSaving,duration:3,desc:t})):this.$Notice.error({title:this.lang.errorSaving,duration:3,desc:e}),this.asyncMode=!1,this.$props.onError&&this.$props.onError()})))},handleReset(e){this.model={},this.$refs[e].resetFields(),(0,s.i)(this.identity,null),this.schema.forEach((e=>{"SubForm"==e.formType&&void 0!==this.$refs[`sf${e.model}`]&&this.$refs[`sf${e.model}`][0].reset(),this.setModel(e.model,e.default,e.formType),e.hidden=e.source_hidden,e.disabled=e.source_disabled})),this.setHiddenItemModel(this.schema),this.setCustomData()},setIdentityManual(){(0,s.i)(this.identity,this.model[this.identity])},setUserConditionValues(e){this.user_condition&&this.user_condition.forEach((t=>{let i=this.getSchemaByModel(t.form_field);i&&(""!=i.default&&null!==i.default&&0!=i.default||e)&&(""!=this.model[i.model]&&null!==this.model[i.model]&&0!=this.model[i.model]||(e?(this.model[i.model]=window.init.user[t.user_field],i.default=window.init.user[t.user_field]):this.setModel(i.model,i.default,i.formType)))}))},setCustomData(){this.formCustomData&&Object.keys(this.formCustomData).forEach((e=>{let t=this.schema.findIndex((t=>t.model==e));t>=0&&(Vue.set(this.schema[t],"disabled",!0),Vue.set(this.schema[t],"default",this.formCustomData[e]),Vue.set(this.$data.model,e,this.formCustomData[e]))}))},editModel(e,t){t?(this.model={...this.model,...t},this.ui&&this.ui.hasOwnProperty("schema")&&(this.setEditModel(this.ui.schema),this.setUserConditionValues(!1),this.setCustomData())):(this.dataID=e,(0,s.i)(this.identity,e),axios.post(this.page_id?`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/edit/${e}?page_id=${this.page_id}`:`${this.baseUrl}/lambda/krud/${this.$props.schemaID}/edit/${e}`).then((({data:e})=>{e.status&&(this.model={...this.model,...e.data},this.ui&&this.ui.hasOwnProperty("schema")&&this.setEditModel(this.ui.schema),this.setUserConditionValues(!1),this.setCustomData())})))},setHiddenValues(e){e.map((e=>{this.model[e.key]=e.val}))},subFormFillData(e){this.$refs[`sf${e}`]&&this.$refs[`sf${e}`].length>=1?this.$refs[`sf${e}`][0].fillData():setTimeout((()=>{this.subFormFillData(e)}),100)},setEditModel(e){e.forEach((e=>{if("form"==e.type||"Form"==e.type||"SubForm"==e.formType)switch(e.formType){case"SubForm":this.subFormFillData(e.model);break;case"Switch":1==this.model[e.model]||"true"==this.model[e.model]?this.model[e.model]=!0:this.model[e.model]=!1;break;case"Password":case"PasswordGenerate":this.model[e.model]="",delete this.$data.rule[e.model]}else _.isArray(e.children)&&this.setEditModel(e.children)}))},cloneModel(e){axios.post(`/lambda/krud/${this.$props.schemaID}/edit/${e}`).then((({data:e})=>{e.status&&(this.model={...this.model,...e.data},delete this.model[this.identity],console.log(this.identity),console.log(this.model[this.identity]),this.setEditModel(this.ui.schema),this.setUserConditionValues(!1),this.setCustomData())}))},getOptionsByRelations(e,t){Object.keys(t).length>=1&&axios.post(`${e}/lambda/puzzle/get_options${this.optionUrl}`,{relations:t}).then((({data:e})=>{Object.keys(e).map((t=>{let i={...this.relations[t],data:e[t]};Vue.set(this.$data.relations,t,i)}))}))},getOptionsData(e){this.relations=this.getSelects(e,void 0),window.init.microserviceSettings&&window.init.microserviceSettings.length>=1?window.init.microserviceSettings.forEach((t=>{let i=this.getSelects(e,t.project_id);this.getOptionsByRelations(t.production_url,i)})):this.getOptionsByRelations("",this.relations)},getSelectItem(e,t){if(e.relation.filterWithUser){if(e.relation.filterWithUser&&e.relation.filterWithUser.constructor===Array){let t="";e.relation.filterWithUser.forEach((e=>{let i=`${e.tableField} = '${window.init.user[e.userField]}'`;t=""==t?i:t+" AND "+i})),""==e.relation.filter||void 0===e.relation.filter?e.relation.filter=t:e.relation.filter=`(${e.relation.filter}) OR (${t})`}else{let t=`${e.relation.filterWithUser.tableField} = '${window.init.user[e.relation.filterWithUser.userField]}'`;""==e.relation.filter||void 0===e.relation.filter?e.relation.filter=t:e.relation.filter=e.relation.filter+" AND "+t}e.relation.filterWithUser=void 0}return""==e.relation.filter||void 0===e.relation.filter?t[e.relation.table]=e.relation:t[e.model]=e.relation,t},getSelects(e,t){let i={};return e.map((e=>{if("Radio"!=e.formType&&"Select"!=e.formType&&"ISelect"!=e.formType&&"TreeSelect"!=e.formType||e.relation.table&&void 0===i[e.relation.table]&&(void 0!==t?e.relation.microservice_id==t&&(i=this.getSelectItem(e,i)):i=this.getSelectItem(e,i)),"AdminMenu"==e.formType&&e.relation.table&&(i[e.relation.table]=e.relation),"SubForm"==e.formType&&e.schema){let o=this.getSelects(e.schema,t);o&&(i={...i,...o})}})),i},showInformationModal(e,t){this.infoTitle=t,this.infoUrl=e,this.showInfo=!0},getRelation(e){return(0,l.gN)(e,this.relations)},getFooterButtons(){let e=[];return this.schema.forEach((t=>{"FooterButton"==t.formType&&e.push({...t})})),e},setAndSend(e,t){Vue.set(this.$data.model,e,t),console.log(e,t),console.log(this.$data.model),this.handleSubmit(this.meta.model+"-"+this.schemaID)}}}]};const m=(0,i(51900).Z)(d,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.viewMode?"dataform view-mode":"dataform"},[i("Form",{ref:e.meta.model+"-"+e.schemaID,attrs:{model:e.model,rules:e.rule,"label-position":e.meta.option.labelPosition,"label-width":"top"==e.meta.option.labelPosition?void 0:e.meta.option.labelWidth}},[i("div",{staticClass:"dataform-header"},[i("h3",[e._v(e._s(e.title?e.title:e.formTitle)),e.showID?i("b",[e.model[e.identity]?i("span",[e._v(": "+e._s(e.model[e.identity]))]):e._e()]):e._e()])]),e._v(" "),e.loadConfig?e._e():i("div",{staticClass:"dataform-body"},[e.loadConfig?i("Spin",{attrs:{fix:""}}):e._e(),e._v(" "),e._l(e.ui.schema,(function(t){return i("Row",{key:t.index},[e._l(t.children,(function(o){return e.isVisibleSection(o)&&!t.sectionRenderByTab?i("Col",{key:o.index,attrs:{xs:o.span.xs,sm:o.span.sm,md:o.span.md,lg:o.span.lg}},[i("div",{class:""!=o.name?"fieldset":""},[""!=o.name?i("legend",[e._v(e._s(o.name))]):e._e(),e._v(" "),e._l(o.children,(function(t){return i("Row",{key:t.index},e._l(t.children,(function(t){return i("Col",{key:t.index,attrs:{id:t.id,xs:24,sm:24,md:t.span.md,lg:t.span.lg}},[t.name?i("Divider",{staticClass:"form-divider",attrs:{orientation:"left"}},[e._v(e._s(t.name)+"\n                                ")]):e._e(),e._v(" "),e._l(t.children,(function(t){return i("span",{key:t.index},[e.isShow(t.model)&&"SubForm"==t.formType&&t.subtype?i(e.element("subform/"+t.subtype),{ref:"sf"+t.model,refInFor:!0,tag:"component",attrs:{url:e.url,model:{form:e.model,component:t.model},form:e.setMeta(t,!0),formula:e.formula,relations:e.relations,editMode:e.editMode}}):e._e(),e._v(" "),e.isShow(t.model)&&"SubForm"!=t.formType?i(e.element(t.formType),{tag:"component",attrs:{do_render:e.do_render,editMode:e.editMode,model:{form:e.model,component:t.model},disabled:!!t.disabled&&t.disabled,label:t.label?t.label:"["+t.model+"]",rule:t.model,meta:e.setMeta(t),identity:e.identity,url:e.url,getSchemaByModel:e.getSchemaByModel,getSchemaRelationByModel:e.getSchemaRelationByModel,setSchemaByModel:e.setSchemaByModel,relation_data:e.getRelation(t)}}):e._e()],1)}))],2)})),1)}))],2)]):e._e()})),e._v(" "),t.sectionRenderByTab?i("Tabs",{attrs:{value:0}},e._l(t.children,(function(t){return e.isVisibleSection(t)?i("TabPane",{key:t.index,attrs:{label:t.name,name:t.index}},e._l(t.children,(function(t){return i("Row",{key:t.index},e._l(t.children,(function(t){return i("Col",{key:t.index,attrs:{id:t.id,xs:24,sm:24,md:t.span.md,lg:t.span.lg}},[t.name?i("Divider",{staticClass:"form-divider",attrs:{orientation:"left"}},[e._v(e._s(t.name)+"\n                                ")]):e._e(),e._v(" "),e._l(t.children,(function(t){return i("span",{key:t.index},[e.isShow(t.model)&&"SubForm"==t.formType&&t.subtype?i(e.element("subform/"+t.subtype),{ref:"sf"+t.model,refInFor:!0,tag:"component",attrs:{model:{form:e.model,component:t.model},form:e.setMeta(t,!0),formula:e.formula,url:e.url,relations:e.relations,editMode:e.editMode}}):e._e(),e._v(" "),e.isShow(t.model)&&"SubForm"!=t.formType?i(e.element(t.formType),{tag:"component",attrs:{do_render:e.do_render,editMode:e.editMode,model:{form:e.model,component:t.model},url:e.url,disabled:!!t.disabled&&t.disabled,label:t.label?t.label:"["+t.model+"]",rule:t.model,meta:e.setMeta(t),identity:e.identity,getSchemaByModel:e.getSchemaByModel,getSchemaRelationByModel:e.getSchemaRelationByModel,setSchemaByModel:e.setSchemaByModel,relation_data:e.getRelation(t)}}):e._e()],1)}))],2)})),1)})),1):e._e()})),1):e._e(),e._v(" "),e._l(t.children,(function(t){return"col"==t.type?i("Col",{key:t.index,attrs:{xs:t.span.xs,sm:t.span.sm,md:t.span.md,lg:t.span.lg}},[t.name?i("Divider",{staticClass:"form-divider",attrs:{orientation:"left"}},[e._v(e._s(t.name))]):e._e(),e._v(" "),e._l(t.children,(function(t){return i("span",{key:t.index},[e.isShow(t.model)&&"SubForm"==t.formType&&t.subtype?i(e.element("subform/"+t.subtype),{ref:"sf"+t.model,refInFor:!0,tag:"component",attrs:{label:t.label?t.label:"["+t.model+"]",model:{form:e.model,component:t.model},form:e.setMeta(t,!0),relations:e.relations,formula:e.formula,schemaID:e.schemaID,url:e.url,editMode:e.editMode}}):e._e(),e._v(" "),e.isShow(t.model)&&"SubForm"!=t.formType?i(e.element(t.formType),{tag:"component",attrs:{do_render:e.do_render,editMode:e.editMode,disabled:!!t.disabled&&t.disabled,model:{form:e.model,component:t.model},label:t.label?t.label:"["+t.model+"]",rule:t.model,meta:e.setMeta(t),identity:e.identity,getSchemaByModel:e.getSchemaByModel,getSchemaRelationByModel:e.getSchemaRelationByModel,setSchemaByModel:e.setSchemaByModel,relation_data:e.getRelation(t)}}):e._e()],1)}))],2):e._e()}))],2)}))],2),e._v(" "),e.viewMode?e._e():i("div",{staticClass:"dataform-footer"},[e.withBackButton?i("Button",{staticStyle:{"margin-right":"8px"},on:{click:e.close}},[e._v("\n                Буцах\n            ")]):e._e(),e._v(" "),e._l(e.extraButtons,(function(t){return i("Button",{key:t.index,style:e.editMode?"margin-right: 8px; color:"+t.color+"; border-color:"+t.color:"margin-right: 8px;",attrs:{disabled:!e.editMode,to:e.createWithTemplate(t.url),target:"_blank"}},[i("i",{class:t.icon,style:e.editMode?"color:"+t.color:""}),e._v("\n                "+e._s(t.title)+"\n            ")])})),e._v(" "),i("Button",{attrs:{type:"info",loading:e.asyncMode},on:{click:function(t){return e.handleSubmit(e.meta.model+"-"+e.schemaID)}}},[e.asyncMode?i("span",[e._v("\n                    "+e._s(e.lang.pleaseWait)+"\n                ")]):i("span",[e._v("\n                    "+e._s("Хадгалах"!=e.save_btn_text&&""!=e.save_btn_text?e.save_btn_text:e.lang.save)+"\n                ")])]),e._v(" "),e.editMode||e.disableReset?e._e():i("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.handleReset(e.meta.model+"-"+e.schemaID)}}},[e._v("\n                "+e._s(e.lang.fillInTheNewOne)+"\n            ")]),e._v(" "),e._l(e.getFooterButtons(),(function(t){return i("span",{staticClass:"extra-buttons"},e._l(t.options,(function(o){return i("Button",{key:t.inex,attrs:{type:"info",loading:e.asyncMode},on:{click:function(i){return e.setAndSend(t.model,o.value)}}},[e._v("\n                 "+e._s(o.label)+"\n                ")])})),1)}))],2)]),e._v(" "),i("Drawer",{staticClass:"info-modal",attrs:{title:e.infoTitle,width:"860px"},model:{value:e.showInfo,callback:function(t){e.showInfo=t},expression:"showInfo"}},[i("iframe",{attrs:{src:e.infoUrl,frameborder:"0"}}),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.showInfo=!1}}},[e._v("\n                "+e._s(e.lang.close)+"\n            ")])],1)])],1)}),[],!1,null,null,null).exports},51900:(e,t,i)=>{"use strict";function o(e,t,i,o,s,r,n,a){var l,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=i,d._compiled=!0),o&&(d.functional=!0),r&&(d._scopeId="data-v-"+r),n?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},d._ssrRegister=l):s&&(l=a?function(){s.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(d.functional){d._injectStyles=l;var m=d.render;d.render=function(e,t){return l.call(t),m(e,t)}}else{var h=d.beforeCreate;d.beforeCreate=h?[].concat(h,l):[l]}return{exports:e,options:d}}i.d(t,{Z:()=>o})}}]);
//# sourceMappingURL=Dataform-el.2e62f8fcd7c7db30.js.map