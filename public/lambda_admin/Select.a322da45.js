import{m as ye}from"./_mixin.6a9d7197.js";import{aq as _,aw as _e,at as we,av as $,an as G,ay as H,ah as c,aA as xe,aB as Fe,aC as Se,aD as K,aE as Ne,aF as Te,a as Be}from"./entry.0dfbcad4.js";import{c as Pe,B as Ae,M as h,o as Ie,d as x}from"./Modal.e028f6af.js";import{l as A,t as Q,d as X,o as Oe,c as r,q as Y,S as y,Y as F,a8 as B,a4 as w,aa as Ve,_ as O,a7 as P,Z as Me}from"./vue.a1a1d817.js";import"./cryptoJs.37acf5e1.js";import"./ant.3cb96f1d.js";import"./common.db75f8be.js";import"./numeral.f32c122b.js";import"./moment.8b5e7d95.js";var De=function(){var e=A(!1);return Q(function(){e.value=!0}),e};const Re=De;var Ee={type:{type:String},actionFn:Function,close:Function,autofocus:Boolean,prefixCls:String,buttonProps:Object,emitEvent:Boolean,quitOnNullishReturnValue:Boolean};function Z(t){return!!(t&&!!t.then)}const J=X({name:"ActionButton",props:Ee,setup:function(e,f){var i=f.slots,l=A(!1),u=A(),d=A(!1),v,p=Re();Oe(function(){e.autofocus&&(v=setTimeout(function(){var n;return(n=u.value.$el)===null||n===void 0?void 0:n.focus()}))}),Q(function(){clearTimeout(v)});var k=function(a){var o=e.close;!Z(a)||(d.value=!0,a.then(function(){p.value||(d.value=!1),o.apply(void 0,arguments),l.value=!1},function(m){console.error(m),p.value||(d.value=!1),l.value=!1}))},s=function(a){var o=e.actionFn,m=e.close,b=m===void 0?function(){}:m;if(!l.value){if(l.value=!0,!o){b();return}var C;if(e.emitEvent){if(C=o(a),e.quitOnNullishReturnValue&&!Z(C)){l.value=!1,b(a);return}}else if(o.length)C=o(b),l.value=!1;else if(C=o(),!C){b();return}k(C)}};return function(){var n=e.type,a=e.prefixCls,o=e.buttonProps;return r(Ae,_(_(_({},Pe(n)),{},{onClick:s,loading:d.value,prefixCls:a},o),{},{ref:u}),i)}}});function S(t){return typeof t=="function"?t():t}const ze=X({name:"ConfirmDialog",inheritAttrs:!1,props:["icon","onCancel","onOk","close","closable","zIndex","afterClose","visible","keyboard","centered","getContainer","maskStyle","okButtonProps","cancelButtonProps","okType","prefixCls","okCancel","width","mask","maskClosable","okText","cancelText","autoFocusButton","transitionName","maskTransitionName","type","title","content","direction","rootPrefixCls","bodyStyle","closeIcon","modalRender","focusTriggerAfterClose","wrapClassName"],setup:function(e,f){var i=f.attrs,l=_e("Modal"),u=we(l,1),d=u[0];return function(){var v=e.icon,p=e.onCancel,k=e.onOk,s=e.close,n=e.closable,a=n===void 0?!1:n,o=e.zIndex,m=e.afterClose,b=e.visible,C=e.keyboard,V=e.centered,te=e.getContainer,ne=e.maskStyle,oe=e.okButtonProps,le=e.cancelButtonProps,M=e.okCancel,D=M===void 0?!0:M,R=e.width,ae=R===void 0?416:R,E=e.mask,re=E===void 0?!0:E,z=e.maskClosable,ie=z===void 0?!1:z,j=e.type,L=e.title,se=e.content,ce=e.direction,ue=e.closeIcon,de=e.modalRender,fe=e.focusTriggerAfterClose,T=e.rootPrefixCls,me=e.bodyStyle,he=e.wrapClassName,Ce=e.okType||"primary",I=e.prefixCls||"ant-modal",g="".concat(I,"-confirm"),ve=i.style||{},pe=S(e.okText)||(D?d.value.okText:d.value.justOkText),be=S(e.cancelText)||d.value.cancelText,q=e.autoFocusButton===null?!1:e.autoFocusButton||"ok",ge=$(g,"".concat(g,"-").concat(j),"".concat(I,"-").concat(j),G({},"".concat(g,"-rtl"),ce==="rtl"),i.class),ke=D&&r(J,{actionFn:p,close:s,autofocus:q==="cancel",buttonProps:le,prefixCls:"".concat(T,"-btn")},{default:function(){return[be]}});return r(h,{prefixCls:I,class:ge,wrapClassName:$(G({},"".concat(g,"-centered"),!!V),he),onCancel:function(W){return s({triggerCancel:!0},W)},visible:b,title:"",footer:"",transitionName:H(T,"zoom",e.transitionName),maskTransitionName:H(T,"fade",e.maskTransitionName),mask:re,maskClosable:ie,maskStyle:ne,style:ve,bodyStyle:me,width:ae,zIndex:o,afterClose:m,keyboard:C,centered:V,getContainer:te,closable:a,closeIcon:ue,modalRender:de,focusTriggerAfterClose:fe},{default:function(){return[r("div",{class:"".concat(g,"-body-wrapper")},[r("div",{class:"".concat(g,"-body")},[S(v),L===void 0?null:r("span",{class:"".concat(g,"-title")},[S(L)]),r("div",{class:"".concat(g,"-content")},[S(se)])]),r("div",{class:"".concat(g,"-btns")},[ke,r(J,{type:Ce,actionFn:k,close:s,autofocus:q==="ok",buttonProps:oe,prefixCls:"".concat(T,"-btn")},{default:function(){return[pe]}})])])]}})}}});var je=function(e){var f=document.createDocumentFragment(),i=c(c({},Ie(e,["parentContext","appContext"])),{close:d,visible:!0}),l=null;function u(){l&&(Y(null,f),l.component.update(),l=null);for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];var o=n.some(function(C){return C&&C.triggerCancel});e.onCancel&&o&&e.onCancel.apply(e,n);for(var m=0;m<x.length;m++){var b=x[m];if(b===d){x.splice(m,1);break}}}function d(){for(var s=this,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];i=c(c({},i),{visible:!1,afterClose:function(){typeof e.afterClose=="function"&&e.afterClose(),u.apply(s,a)}}),v(i)}function v(s){typeof s=="function"?i=s(i):i=c(c({},i),s),l&&(c(l.component.props,i),l.component.update())}var p=function(n){var a=Te,o=a.prefixCls,m=n.prefixCls||"".concat(o,"-modal");return r(Ne,_(_({},a),{},{notUpdateGlobalConfig:!0,prefixCls:o}),{default:function(){return[r(ze,_(_({},n),{},{rootPrefixCls:o,prefixCls:m}),null)]}})};function k(s){var n=r(p,c({},s));return n.appContext=e.parentContext||e.appContext||n.appContext,Y(n,f),n}return l=k(i),x.push(d),{destroy:d,update:v}};const N=je;function Le(t){return c(c({icon:function(){return r(K,null,null)},okCancel:!1},t),{type:"warning"})}function qe(t){return c(c({icon:function(){return r(xe,null,null)},okCancel:!1},t),{type:"info"})}function Ue(t){return c(c({icon:function(){return r(Fe,null,null)},okCancel:!1},t),{type:"success"})}function We(t){return c(c({icon:function(){return r(Se,null,null)},okCancel:!1},t),{type:"error"})}function $e(t){return c(c({icon:function(){return r(K,null,null)},okCancel:!0},t),{type:"confirm"})}function ee(t){return N(Le(t))}h.info=function(e){return N(qe(e))};h.success=function(e){return N(Ue(e))};h.error=function(e){return N(We(e))};h.warning=ee;h.warn=ee;h.confirm=function(e){return N($e(e))};h.destroyAll=function(){for(;x.length;){var e=x.pop();e&&e()}};h.install=function(t){return t.component(h.name,h),t};const Ge={mixins:[ye],components:{"a-modal":h},computed:{lang(){const t=["dataNotFound"];return t.reduce((e,f,i)=>(e[f]=this.$t("dataForm."+t[i]),e),{})},addAble(){return this.meta.relation.addAble&&this.meta.relation.addFrom},selectClass(){let t="";return this.meta.info_url&&this.model.form[this.model.component]&&(t=t+" with-info-caller "),this.addAble&&(t=t+" addable-select "),t}},data(){return{selectValue:null,modal_show:!1}},methods:{changeValue(t){t!=null?this.meta.relation.multiple===!0?this.model.form[this.model.component]=t.join(","):t===""?this.model.form[this.model.component]=null:isNaN(t)?this.model.form[this.model.component]=t:this.model.form[this.model.component]=t*1:this.model.form[this.model.component]=null},addFromUrl(){if(window.init)if(window.init.microserviceSettings){let t=window.init.microserviceSettings.findIndex(e=>e.project_id==this.meta.relation.addFromMicroservice);return t>=0?window.init.microserviceSettings[t].production_url:this.url}else return this.url;else return this.url},showAddModal(){this.modal_show=!0},closeModal(){this.modal_show=!1},onSuccess(t){let e=this.meta.relation.fields.map(i=>t[i]);e=e.join(", ");let f={value:t[this.meta.relation.key],label:e};this.meta.relation.parentFieldOfTable!==""&&this.meta.relation.parentFieldOfForm!==""&&(f.parent_value=t[this.meta.relation.parentFieldOfTable].toString()),this.relation_data(this.meta).push(f),this.closeModal()},onError(t){},showInfoModal(){this.model.form[this.model.component]&&window.showInformationModal(`${this.meta.info_url}${this.model.form[this.model.component]}`,this.meta.placeHolder)},search(t){console.log(t)},initialValue(t){this.model.form[this.model.component]?this.model.form[this.meta.relation.parentFieldOfForm]?t.findIndex(f=>f.value===this.model.form[this.model.component])>=0?this.setSelectValue():this.setNull():this.setSelectValue():this.setNull()},setSelectValue(){this.meta.relation.multiple===!0&&this.model.form[this.model.component]!==""?this.selectValue=this.model.form[this.model.component].split(",").map(t=>isNaN(t)?t:t*1):this.selectValue=this.model.form[this.model.component]},setNull(){this.meta.relation.multiple===!0?this.selectValue=[]:this.selectValue=null}},watch:{do_render(t){t||(this.value=null,this.clearAble=!1,this.ignoreChange=!1)}}},He={class:"svg-icon"},Ye={class:"svg-icon"},Ze={key:0,class:"add-modal"},Je={class:"add-body"};function Ke(t,e,f,i,l,u){const d=y("a-select"),v=y("inline-svg"),p=y("a-button"),k=y("a-input-group"),s=y("dataform"),n=y("a-modal"),a=y("lambda-form-item");return F(),B(a,{label:t.label,name:t.model.component,meta:t.meta},{default:w(()=>[r(k,{compact:""},{default:w(()=>[r(d,{value:l.selectValue,"onUpdate:value":e[0]||(e[0]=o=>l.selectValue=o),disabled:t.disabled,autocomplete:"off",allowClear:"",showSearch:"",options:t.options,optionFilterProp:"label",optionLabelProp:"label",mode:t.meta.relation.multiple?"multiple":void 0,onChange:u.changeValue,placeholder:t.placeholder,class:Ve(u.selectClass)},null,8,["value","disabled","options","mode","onChange","placeholder","class"]),u.addAble?(F(),B(p,{key:0,onClick:u.showAddModal},{icon:w(()=>[O("span",He,[r(v,{src:"/assets/icons/duotune/general/gen041.svg"})])]),_:1},8,["onClick"])):P("",!0),t.meta.info_url&&t.model.form[t.model.component]?(F(),B(p,{key:1,onClick:u.showInfoModal},{icon:w(()=>[O("span",Ye,[r(v,{src:"/assets/icons/duotone/Code/Info-circle.svg"})])]),_:1},8,["onClick"])):P("",!0)]),_:1}),u.addAble?(F(),B(n,{key:0,"min-width":200,"min-height":100,draggable:!0,"footer-hide":!0,title:t.label,width:"800",height:"70%",visible:l.modal_show,"onUpdate:visible":e[1]||(e[1]=o=>l.modal_show=o)},{footer:w(()=>[]),default:w(()=>[l.modal_show?(F(),Me("section",Ze,[O("div",Je,[r(s,{ref:"form",schemaID:t.meta.relation.addFrom,editMode:!1,onSuccess:u.onSuccess,url:u.addFromUrl(),do_render:l.modal_show,onError:u.onError},null,8,["schemaID","onSuccess","url","do_render","onError"])])])):P("",!0)]),_:1},8,["title","visible"])):P("",!0)]),_:1},8,["label","name","meta"])}const it=Be(Ge,[["render",Ke]]);export{it as default};
