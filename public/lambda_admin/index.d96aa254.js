import{H as L,T as P}from"./components.31204c04.js";import{s as l,K as $,P as K,f as N,h as R,j as U,l as j,g as w,a as O,i as z,M as A,L as D,b as C,k as H}from"./entry.b0bba7ab.js";import{R as J}from"./RenderSubMenu.e748560f.js";import{d as V,a as k,n as q,j as F,o as G,w as T,Z as p,a1 as f,a0 as h,_ as S,a6 as W,F as Z,W as c,c as b,a2 as M,$ as I,a8 as Q,H as X,a3 as Y}from"./vue.65c51cdf.js";import"./composables.9c91ecef.js";import"./common.c40c4e6a.js";import"./ant.e036270e.js";import"./moment.8b5e7d95.js";import"./ag.ab39fb93.js";import"./lodash.888217fe.js";import"./numeral.4dda2596.js";import"./cryptoJs.61df0830.js";const x=V({name:"Menu",props:{menu:{type:Array,required:!1,default:[]},mode:{type:String,required:!1,default:"horizontal"},collapsed:{type:Boolean,required:!1,default:!1}},components:{RenderSubMenu:J},setup(e,{emit:n}){const t=l.get($),s=l.get(K),i=l.get(N),m=R(),o=k({value:[]}),u=q([]),a=k({value:[]}),g=F(()=>{const r=[];return e.menu.forEach(d=>r.push(w(d))),r}),_=r=>w(r);G(()=>{v()}),T(()=>e.collapsed,r=>{r?a.value=o.value.concat():o.value=a.value}),T(()=>m.fullPath,r=>{v()});const B=r=>{if(e.mode==="horizontal"){o.value=r;return}const d=r.find(y=>!o.value.includes(y));g.value.includes(d)?o.value=d?[d]:[]:o.value=r},E=({item:r,key:d,selectedKeys:y})=>{u.value=y,n("select",{item:r,key:d,selectedKeys:u})},v=()=>{if(i){u.value=[m.path];let r=[];e.mode!=="horizontal"&&(r=U(i,m.path)),e.collapsed?a.value=r:o.value=r}};return{openKeys:o,selectedKeys:u,onOpenChange:B,onSelect:E,permissions:s,kruds:t,getPath:_,layoutMode:j}}});function ee(e,n,t,s,i,m){const o=c("RenderSubMenu"),u=c("a-menu");return p(),f(u,{mode:e.mode,openKeys:e.openKeys.value,selectedKeys:e.selectedKeys,onOpenChange:e.onOpenChange,onSelect:e.onSelect,inlineIndent:21,class:"sub-top-menu rounded-md"},{default:h(()=>[(p(!0),S(Z,null,W(e.menu.filter(a=>e.permissions.permissions[a.id].show===!0),a=>(p(),f(o,{key:e.getPath(a),item:a,cruds:e.kruds,permissions:e.permissions.permissions,mode:e.mode,collapsed:e.collapsed},null,8,["item","cruds","permissions","mode","collapsed"]))),128))]),_:1},8,["mode","openKeys","selectedKeys","onOpenChange","onSelect"])}const te=O(x,[["render",ee]]),se={components:{SubTopMenu:te},computed:{menuMode(){let e=localStorage.getItem("menuMode");if(e)return e},isMobile(){return z},path(){return this.$route.fullPath}},data(){const e=l.get($),n=l.get(K),t=l.get(A),s=l.get(N),i=l.get(D);return{options:{height:"1000px"},pageType:"",property:{base_url:C,withCrudLog:i.withCrudLog,withoutHeader:!1,page_id:null,template:"drawer",mode:"refresh",title:"",projects_id:null,grid:null,form:null,form_width:800,view_url:null,actions:null,user_condition:null,parent:[],permissions:{c:!1,r:!1,u:!1,d:!1}},iframeUrl:"",iframeTitle:"",submenu:[],showSub:!1,cruds:e,menu:t,menu_list:s,permissions:n.permissions,pageTitle:"",subMenuId:"0",showNestedMenu:!1,subTopMenus:[],base_url:C}},methods:{getShowAbleChild(e){let n=e.findIndex(t=>this.can(t));return n>=0?e[n]:null},can(e){return this.permissions[e.id]?!!this.permissions[e.id].show:!1},getTitle(e){if(e.link_to=="crud"){let n=this.cruds.findIndex(t=>t.id==e.url);return n>=0?this.cruds[n].title:""}else return e.title},getPage(){var e;if(this.menu_list){let n=this.menu_list.findIndex(t=>t.id===this.$route.params.menu_id);if(n===-1&&(n=this.menu_list.findIndex(t=>t.url===this.$route.path)),n>=0){const t=this.menu_list[n];switch(this.pageType=t.link_to,this.pageType){case"crud":let s=this.cruds.findIndex(i=>i.id==t.url);if(s>=0){this.$route.meta.title=this.cruds[s].title,this.property.parent=t.parent,this.property.title=this.cruds[s].title,this.property.projects_id=this.cruds[s].projects_id,this.property.grid=this.cruds[s].grid,this.property.form=this.cruds[s].form,this.property.edit_id=this.cruds[s].edit_id,this.property.template=this.cruds[s].template,this.cruds[s].actions&&(this.property.actions=this.cruds[s].actions),this.property.main_tab_title=this.cruds[s].main_tab_title,this.property.form_width=this.cruds[s].form_width?this.cruds[s].form_width:null,this.property.view_url=this.cruds[s].view_url,this.property.permissions.c=this.permissions[t.id].c,this.property.permissions.r=this.permissions[t.id].r,this.property.permissions.u=this.permissions[t.id].u,this.property.permissions.d=this.permissions[t.id].d,this.property.permissions.gridDeleteConditionJS=this.permissions[t.id].gridDeleteConditionJS,this.property.permissions.gridEditConditionJS=this.permissions[t.id].gridEditConditionJS;let i={};this.permissions[t.id].formCondition&&(i.formCondition=this.permissions[t.id].formCondition),this.permissions[t.id].gridCondition&&(i.gridCondition=this.permissions[t.id].gridCondition),i&&(this.property.user_condition=i),this.property.page_id=t.id}break;case"link":window.location=this.menu_list[n].url;break;case"router-link":this.$router.push(this.menu_list[n].url);break;case"iframe":this.iframeUrl=t.url,this.property.title=t.title;break}if(((e=t.parent)==null?void 0:e.length)>=1){const s=t.parent.findIndex(i=>i.link_to==="noActionSubTop");if(s>=0){const{children:i}=H(this.menu,t.parent[s].id);i!=null&&i.length&&(this.subTopMenus=i)}}}}}},beforeMount(){this.getPage()}},ie={mixins:[se]},ne={class:"rounded-md grid grow grid-nogutter"},re={key:1,class:"iframe-page"},oe=["src"];function ae(e,n,t,s,i,m){const o=P,u=L,a=c("SubTopMenu"),g=c("portal"),_=c("krud");return p(),S("div",ne,[b(u,null,{default:h(()=>[b(o,null,{default:h(()=>[X(Y(e.property.title),1)]),_:1})]),_:1}),e.subTopMenus.length?(p(),f(g,{key:0,to:"sub-top-menu"},{default:h(()=>[b(a,{menu:e.subTopMenus,collapsed:!1,mode:"horizontal"},null,8,["menu"])]),_:1})):M("",!0),I("div",{class:Q(`${e.subTopMenus.length?"with-top-menu":""}`)},[e.pageType==="crud"&&e.property.page_id!=null?(p(),f(_,{key:0,template:e.property.template,property:e.property,base_url:e.property.base_url},null,8,["template","property","base_url"])):M("",!0)],2),e.pageType==="iframe"?(p(),S("div",re,[I("iframe",{src:e.iframeUrl},null,8,oe)])):M("",!0)])}const Me=O(ie,[["render",ae]]);export{Me as default};
