import{m as c}from"./_mixin.eef67487.js";import{a as g}from"./entry.f4b9eee7.js";import{L,P as _,m as w}from"./ant.e036270e.js";import{Z as l,a1 as m,a0 as r,c as b,$ as y,_ as C,a2 as M,W as n}from"./vue.65c51cdf.js";import"./common.c40c4e6a.js";import"./moment.8b5e7d95.js";import"./ag.ab39fb93.js";import"./lodash.888217fe.js";import"./numeral.4dda2596.js";import"./cryptoJs.61df0830.js";const v={mixins:[c],components:{LoadingOutlined:L,PlusOutlined:_},computed:{lang(){const e=["viewPhotos","_delete"];return e.reduce((t,s,a)=>(t[s]=this.$t("dataForm."+e[a]),t),{})},isMultiple(){return this.meta.file?!!(typeof this.meta.file.isMultiple<"u"&&this.meta.file.isMultiple):!1}},mounted(){this.init()},data(){return{defaultList:[],uploadList:[],showImage:!1,showImageUrl:"",loading:!1}},watch:{itemValue(e,t){(t&&!e||e&&!t)&&(e?this.init():this.uploadList=[])}},methods:{init(){if(this.model.form[this.model.component])if(this.isMultiple){if(JSON.stringify(this.uploadList!==this.model.form[this.model.component])){let e=JSON.parse(this.model.form[this.model.component]);Array.isArray(e)&&(this.uploadList=e)}}else{let e=this.model.form[this.model.component].split("/"),t="";e.length>=1&&(t=e[e.length-1]),this.uploadList.length>=1?this.uploadList[0].response!==this.model.form[this.model.component]&&(this.uploadList=[{status:"done",thumbUrl:this.url+this.model.form[this.model.component],response:this.model.form[this.model.component],name:t}]):this.uploadList=[{status:"done",thumbUrl:this.url+this.model.form[this.model.component],response:this.model.form[this.model.component],name:t}]}},onVisibleChange(e){this.showImage=e},handleView(e){this.showImage=!0,this.showImageUrl=this.url+e.response},handleChange(e){if(this.isMultiple){if(e.file.status==="uploading"){this.loading=!0;return}let t=[];this.uploadList.forEach(s=>{s.status==="done"&&t.push({status:"done",thumbUrl:this.url+s.response,response:s.response,name:s.name})}),t.length===this.uploadList.length&&(this.model.form[this.model.component]=JSON.stringify(t),this.loading=!1)}else{if(e.file.status==="uploading"){this.loading=!0;return}e.file.status==="done"&&(this.model.form[this.model.component]=e.file.response,this.uploadList=[{status:"done",thumbUrl:this.url+this.model.form[this.model.component],response:this.model.form[this.model.component],name:e.file.name}],this.loading=!1),e.file.status==="error"&&(this.uploadList=this.uploadList.filter(t=>t.status==="done"),this.loading=!1,w.error(this.$t("alertMessage.errorMsg")))}},success(e){this.meta.file?this.isMultiple?(this.uploadList=this.$refs.upload.fileList,this.model.form[this.model.component]=JSON.stringify(this.uploadList.map(t=>({name:t.name,response:t.response})))):this.model.form[this.model.component]=e:this.model.form[this.model.component]=e},handleRemove(e){this.isMultiple?this.model.form[this.model.component]=JSON.stringify(this.uploadList.filter(t=>t.response!==e.response)):this.model.form[this.model.component]=null}}},I={key:1,class:"ti ti-camera"};function N(e,t,s,a,i,o){const d=n("loading-outlined"),h=n("a-upload"),p=n("a-image"),u=n("lambda-form-item");return l(),m(u,{label:e.label,name:e.model.component,meta:e.meta},{default:r(()=>[b(h,{"file-list":i.uploadList,"onUpdate:fileList":t[0]||(t[0]=f=>i.uploadList=f),multiple:this.isMultiple,disabled:e.disabled,name:"file","list-type":"picture-card",action:`${e.url?e.url:""}/lambda/krud/upload`,onPreview:o.handleView,onChange:o.handleChange,onRemove:o.handleRemove},{default:r(()=>[y("div",null,[i.loading?(l(),m(d,{key:0})):(l(),C("i",I))])]),_:1},8,["file-list","multiple","disabled","action","onPreview","onChange","onRemove"]),i.showImageUrl?(l(),m(p,{key:0,width:200,style:{display:"none"},preview:{visible:i.showImage,onVisibleChange:o.onVisibleChange},src:i.showImageUrl},null,8,["preview","src"])):M("",!0)]),_:1},8,["label","name","meta"])}const E=g(v,[["render",N]]);export{E as default};
